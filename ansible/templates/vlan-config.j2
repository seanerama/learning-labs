!
! VLAN Configuration Template
! Generated by Ansible
! Device: {{ inventory_hostname }}
! Date: {{ ansible_date_time.iso8601 }}
!

!
! VLAN Database Configuration
!
{% for vlan in vlans %}
vlan {{ vlan.id }}
 name {{ vlan.name }}
{% endfor %}

!
! Spanning Tree Configuration
!
spanning-tree mode {{ stp_mode | default('rapid-pvst') }}
{% for vlan in vlans %}
spanning-tree vlan {{ vlan.id }} priority {{ vlan.priority | default(stp_priority | default(32768)) }}
{% endfor %}

!
! Trunk Interface Configuration
!
{% for interface in trunk_interfaces %}
interface {{ interface }}
 description Trunk Port - Managed by Ansible
 switchport trunk encapsulation dot1q
 switchport mode trunk
 switchport trunk allowed vlan {{ allowed_vlans | default(vlans | map(attribute='id') | join(',')) }}
 switchport trunk native vlan {{ native_vlan | default(1) }}
 no shutdown
{% endfor %}

!
! Access Interface Configuration
!
{% for interface in access_interfaces %}
interface {{ interface.name }}
 description {{ interface.description | default('Access Port - Managed by Ansible') }}
 switchport mode access
 switchport access vlan {{ interface.vlan }}
{% if port_security_enabled | default(false) %}
 switchport port-security
 switchport port-security maximum {{ port_security_max_macs | default(2) }}
 switchport port-security violation {{ port_security_violation | default('restrict') }}
 switchport port-security mac-address sticky
{% endif %}
 spanning-tree portfast
 spanning-tree bpduguard enable
 no shutdown
{% endfor %}

!
! End of VLAN Configuration
!
